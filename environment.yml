---
name: armory-core

# In order of priority: lowest (top) to highest (bottom)
channels:
  - defaults
  - conda-forge
  - anaconda
  - pytorch

dependencies:
  - python=3.9
  - pip>=22.2.0
  - six
  - cudatoolkit=11.6
  - cudnn  # cudnn required for tensorflow
  - conda-forge::ffmpeg  # conda-forge ffmpeg comes with libx264 encoder, which the pytorch channel version does not include. This encoder is required for video compression defenses (ART) and video exporting. Future work could migrate this to libopenh264 encoder, which is available in both channels.
  - tensorflow
  - transformers  # transformers is used for the Entailment metric only
  # ByteTrack (see below)
  # TODO: Should this be added to pyproject.toml; e.g. [byte-track]?
  - pytorch        # Required by ByteTrack, therefore must be installed pre-pip
  - Cython         # ByteTrack
  - lap            # ByteTrack

  - pip:
    # Armory
    - --editable '.[all]'
    # Hydra Lightning Configs
    - 'git+https://github.com/romesco/hydra-lightning.git#subdirectory=hydra-configs-pytorch-lightning'
    # ByteTrack
    - thop          # ByteTrack
    - cython-bbox   # ByteTrack
    - 'git+https://github.com/ifzhang/ByteTrack.git'
    - 'git+https://github.com/cocodataset/cocoapi.git#subdirectory=PythonAPI'

prefix: /opt/conda


# ------------------------------------------------------------------
# DEVELOPER NOTES:
# ------------------------------------------------------------------
# NOTE:
#  - pytorch-lightning >= 1.5.0 will break Deep Speech 2
#  - torchmetrics >= 0.8.0 will break pytorch-lightning 1.4
#  - hydra-lightning installs omegaconf
#  - google-cloud-storage needed for checkpoint.py import
#  - only sox python bindings are installed; underlying sox binaries not needed
# NOTE: Listed dependencies of PyTorch Deep Speech 2, but do not appear
#       to be used for inference (only for training), they are not installed:
#         - torchelastic
#         - wget
#         - flask
#         - fairscale
# ------------------------------------------------------------------
